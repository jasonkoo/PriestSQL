$(function(){function encodeUrl(e){return encodeURIComponent(encodeURIComponent(e))}function downloadFile(e,a,t,i){0==$("#ExcelForm").length&&$(document.body).append('<form target="ExcelIframe" id="ExcelForm"><input type="hidden" id="Excel_path" name="path" /><input type="hidden" id="Excel_proxyUserName" name="proxyUserName" /><input type="hidden" id="Excel_appName" name="appName" /></form><iframe name="ExcelIframe" style="display:none; visibility: hidden;"></iframe>'),$("#Excel_path").val(a),$("#Excel_proxyUserName").val(t),$("#Excel_appName").val(i);var s=document.getElementById("ExcelForm");s.method="post",s.action=e,s.submit()}function getFileType(e){var a;return a=/\.(gif|jpg|jpeg|png|GIF|JPG|PNG|psd|PSD)$/.test(e)?'<i class="fa fa-file-image-o"></i>':/\.(xls|xlsx|csv)$/.test(e)?'<i class="fa fa-file-excel-o"></i>':/\.(docx|doc)$/.test(e)?'<i class="fa fa-file-word-o"></i>':/\.(ppt|pptx)$/.test(e)?'<i class="fa fa-file-powerpoint-o"></i>':/\.(pdf|PDF)$/.test(e)?'<i class="fa fa-file-pdf-o"></i>':/\.(rar|zip|tar|cab|uue|jar|iso|z|7-zip|ace|lzh|arj|gzip|bz2|gz|7z|tgz|deflate)$/.test(e)?'<i class="fa fa-file-zip-o"></i>':'<i class="fa fa-file-o"></i>'}function sizeFormat(e){e=parseInt(e);var a="";return a=e>1.2089258196146292e24?(e/1.2089258196146292e24).toFixed(2)+" YB":e>0x400000000000000000?(e/0x400000000000000000).toFixed(2)+" ZB":e>0x1000000000000000?(e/0x1000000000000000).toFixed(2)+" EB":e>0x4000000000000?(e/0x4000000000000).toFixed(2)+" PB":e>1099511627776?(e/1099511627776).toFixed(2)+" TB":e>1073741824?(e/1073741824).toFixed(2)+" GB":e>1048576?(e/1048576).toFixed(2)+" MB":e>1024?(e/1024).toFixed(2)+" KB":e+" Byte"}function getAppList(){Util.ajax({url:"entry/getApplication",success:function(data){var _html='<div class="keywordSearch"><input type="text" class="form-control" id="UserKeyword" placeholder="Search..."></div><ul class="dropdownMenu">';$.each(data.data,function(e,a){_html+='<li data-user="'+a.appUser+'" data-name="'+a.appName+'"><a href="javascript:;">'+a.appName+"</a></li>",AppList[a.appUser]=a.appName}),_html+="</ul>",$("#UserList").html(_html),store.get(UserName+"user")&&void 0!=AppList[store.get(UserName+"user").split("||")[0]]?$("#UserSel").html(store.get(UserName+"user").split("||")[1]).data({user:store.get(UserName+"user").split("||")[0],name:store.get(UserName+"user").split("||")[1]}):$("#UserSel").html(data.data[0].appName).data({user:data.data[0].appUser,name:data.data[0].appName}),getFileList(),$("#UserKeyword").keyup(function(e){switch(e.keyCode){case 13:case 16:case 17:case 37:case 38:case 39:case 40:break;case 27:break;default:$("#UserList").scrollTop(0),$("#UserList li").each(function(){if(!$(this).hasClass("keywordSearch")){var _keyword=$("#UserKeyword").val(),_thisHtml=$(this).attr("data-name");""!=_keyword?RegExp(_keyword,"i").test($(this).attr("data-name"))?(_thisHtml=_thisHtml.replace(eval("/("+_keyword+")/gi"),'<span class="key">$1</span>'),$(this).find("a").html(_thisHtml),$(this).show()):$(this).hide():(_thisHtml=_thisHtml.replace('<span class="key">',""),_thisHtml=_thisHtml.replace("</span>",""),$(this).find("a").html(_thisHtml),$(this).show())}})}})}})}function getFileList(e,a){$("#FileOpts .btnOpt").addClass("hidden"),$("#FileOpts .btnNew").addClass("hidden"),$("#FileBrowser").show(),$("#FileDetail").hide(),$("#FileFilter").show(),$("#FilePathSearch").show(),$("#FilePathGo").show();var t='<li><a href="fileBrowser.jsp"><i class="fa fa-home"></i> Home</a></li>';if(e){var i=e.split("/"),s="";$.each(i,function(e,a){e<i.length-1&&(s+=a+"/",t+='<li><a href="javascript:;" class="crumbItem" data-path="'+s+'">'+a+"</a></li>")})}$("#Breadcrumb").html(t);var l={proxyUserName:$("#UserSel").data("user"),appName:$("#UserSel").html(),page:a||1,pageSize:50};Sort!=-1&&$.extend(l,Sort);var r="file/fileList";e&&$.extend(l,{path:encodeUrl(e)}),""!=$("#FileFilter").val()&&$.extend(l,{filefilter:$("#FileFilter").val()}),Util.ajax({url:r,data:l,success:function(a){if(SelPathArr=[],$("#FileList").scrollTop(0),0==a.code)return $("#TipNull").removeClass("hidden"),$("#FileListPage").html(""),void $("#FileList").html("");$("#TipNull").addClass("hidden"),a=a.data;var t="";if(e=e||"",""!=e){var i=e.substring(0,e.length-1);i=i.substring(0,i.lastIndexOf("/")+1);var s=PathInfo[e]||"||||||||";t+='<tr data-dir="true" data-up="true" data-path="'+i+'"><td width="5%"><a href="javascript:;" class="sel selAll hided" id="SelAll"><i class="fa fa-check"></i></a><i class="fa fa-folder"></i></td><td width="28%"><a href="javascript:;"><i class="fa fa-level-up"></i></a></td><td width="15%"></td><td width="10%">'+s.split("||")[1]+'</td><td width="10%">'+s.split("||")[2]+'</td><td width="10%">'+s.split("||")[3]+'</td><td width="20%">'+s.split("||")[4]+"</td></tr>"}a.buildable?$("#FileOpts .btnNew").removeClass("hidden"):$("#FileOpts .btnNew").addClass("hidden");var l=!1;$.each(a.files.rows,function(a,i){var s,r,n="",o="";i.dir?(s='<i class="fa fa-folder"></i>',r='<a href="javascript:;" class="fileName">'+i.path.name+"</a>"):(s=getFileType(i.path.name),r='<a href="javascript:;" class="fileName">'+i.path.name+"</a>",n=sizeFormat(i.length)),i.editable?l=!0:o="hided",t+='<tr data-dir="'+i.dir+'" data-name="'+i.path.name+'" data-edit="'+i.editable+'" data-path="'+e+i.path.name+'/"><td width="5%"><a href="javascript:;" class="sel '+o+'" data-edit="'+i.editable+'" data-dir="'+i.dir+'" data-path="'+e+i.path.name+'/" data-name="'+i.path.name+'"><i class="fa fa-check"></i></a>'+s+'</td><td width="28%">'+r+'</td><td width="15%">'+n+'</td><td width="12%">'+i.owner+'</td><td width="10%">'+i.group+'</td><td width="10%">'+i.permission+'</td><td width="20%">'+(null==i.modificationTime?"--":i.modificationTime)+"</td></tr>",PathInfo[e+i.path.name+"/"]=i.length+"||"+i.owner+"||"+i.group+"||"+i.permission+"||"+(null==i.modificationTime?"--":i.modificationTime)}),$("#FileList").html(t),l&&$("#SelAll").removeClass("hided"),a.files.total>50?($("#FileListPage").html('<div class="inner"></div><div class="pageInfo" id="PageInfo"></div>'),$("#FileListPage .inner").bootpag({total:Math.ceil(a.files.total/50),page:a.files.pageIndex,maxVisible:5}).on("page",function(a,t){getFileList(e,t)}),$("#PageInfo").html($.i18n.prop("total")+a.files.total+$.i18n.prop("record"))):$("#FileListPage").html("")}})}function getFileDetail(e,a,t){$("#FileBrowser").hide(),$("#FileFilter").hide(),$("#FilePathSearch").hide(),$("#FilePathGo").hide(),$("#FileDetail").show(),$("#FileOpts .btnNew").addClass("hidden"),"true"==SelPathArr[0].split("||")[3]?$("#FileOpts .btnOpt").removeClass("hidden"):$("#FileOpts .btnOpt").addClass("hidden");var i=SelPathArr[0].split("||")[1]+"";i.lastIndexOf(".")!=-1&&ZipType.indexOf(i.substring(i.lastIndexOf(".")+1))!=-1||$("#FileOpts .btnUnzip").addClass("hidden"),$("#FileOpts .btnDownload").removeClass("hidden");var s='<li><a href="fileBrowser.jsp"><i class="fa fa-home"></i> Home</a></li>';if(e){var l=e.split("/"),r="";$.each(l,function(e,a){e<l.length-1&&(r+=a+"/",s+=e==l.length-2?'<li><a href="javascript:;" data-file="true" class="crumbItem" data-path="'+r+'">'+a+"</a></li>":'<li><a href="javascript:;" class="crumbItem" data-path="'+r+'">'+a+"</a></li>")})}$("#Breadcrumb").html(s),$.each(PathInfo[e].split("||"),function(e,a){0==e?$("#Info_"+e).html(sizeFormat(a)):$("#Info_"+e).html(a)}),DetailPath=e,getFileDetailCon(e)}function getFileDetailCon(e,a){$("#FileDetailCon").html($.i18n.prop("loading")+"..."),$("#FileDetailPage").html("");var t="file/readFile",i={path:encodeUrl(e.substring(0,e.length-1)),proxyUserName:$("#UserSel").data("user"),appName:$("#UserSel").html(),page:a||1,pageSize:5120,charsetName:$("input[name='charsetRadio']:checked").val()};Util.ajax({url:t,data:i,success:function(t){$("#FileDetailCon").scrollTop(0),$("#FileDetailCon").html(t.data),PathInfo[e].split("||")[0]/5120>1?($("#FileDetailPage").html('<div class="inner"></div><div class="pageInfo" id="PageDetailInfo"></div>'),$("#FileDetailPage .inner").bootpag({total:Math.ceil(PathInfo[e].split("||")[0]/5120),page:a||1,maxVisible:10}).on("page",function(a,t){getFileDetailCon(e,t)}),$("#PageInfo").html($.i18n.prop("total")+Math.ceil(PathInfo[e].split("||")[0]/5120)+$.i18n.prop("page"))):$("#FileDetailPage").html("")}})}function refreshFold(e){$("#FileDetail").is(":visible")?"rename"==e?$("#Breadcrumb li:last-child a").click():$("#Breadcrumb li").eq($("#Breadcrumb li").length-2).find("a").click():$("#Breadcrumb li:last-child a").click()}function getFeedback(){Util.ajax({url:"cc/getArticlesByLenovoID",data:{page:1,pageSize:1e3},success:function(e){if(0!=e.data.rows.length){$("#FeedbackMenu").addClass("hasFeed");var a="";$.each(e.data.rows,function(e,t){var i="";t.messageCount>0&&(i='<span class="badge">'+$.i18n.prop("replied")+"</span>");var s=t.messages[0]||"";a+='<li><a href="javascript:;" data-id="'+t.article_id+'" data-reply="'+s+'">'+i+'<span class="tit">'+t.context+"</span></a></li>"}),a+='<li class="divider"></li><li><a href="javascript:;" id="AddNewFeedbackLink"><i class="fa fa-plus"></i>&nbsp;'+$.i18n.prop("newFeedback")+"</a></li>",$("#FeedbackList").html(a),$("#AddNewFeedbackLink").click(function(){newFeedback()})}}})}function newFeedback(){var e=BootstrapDialog.show({title:$.i18n.prop("feedback"),cssClass:"feedback-dialog",message:'<div class="addValueDialog" id="AddValueDialog"><textarea class="form-control feedbackText" placeholder="'+$.i18n.prop("feedbackPlaceholder")+'" style="height:150px"></textarea><div class="btnWrap"><a href="javascript:;" class="btn btn-primary" id="AddNewFeedbackBtn">'+$.i18n.prop("submit")+"</a></div></div>",onshown:function(){$("#AddNewFeedbackBtn").off("click").on("click",function(){$(this).addClass("disable");var a=$("#AddValueDialog .feedbackText").val();return""==a?(swal("Error",$.i18n.prop("feedbackNullTip")+"!","error"),void $("#AddNewFeedbackBtn").removeClass("disable")):void Util.ajax({url:"cc/savaArticle",data:{title:"",keyword:"",context:encodeURIComponent(a)},success:function(a){1==a.code?(swal($.i18n.prop("addSuccess")+"!","","success"),getFeedback(),e.close()):(swal("Error",a.data,"error"),$("#AddNewFeedbackBtn").removeClass("disable"))}})})}})}function bindEvent(){$("#Logout").click(function(){window.location.href="logout"}),$("#FileList").on("mouseenter","tr",function(){$(this).find(".fa-folder").addClass("fa-folder-open")}),$("#FileList").on("mouseleave","tr",function(){$(this).find(".fa-folder").removeClass("fa-folder-open")}),$("#FileList").on("click","tr",function(){if($("#FileFilter").val(""),$(this).data("dir")){var e=$(this).data("path");""!=e?getFileList(e):getFileList()}else{var e=$(this).data("path");SelPathArr=[$(this).data("path")+"||"+$(this).data("name")+"||"+$(this).data("dir")+"||"+$(this).data("edit")],getFileDetail(e)}}),$("#Breadcrumb").on("click",".crumbItem",function(){if($("#FileFilter").val(""),""!=$(this).data("path")){var e=$(this).data("path");$(this).data("file")?getFileDetail(e):""!=e?getFileList(e):getFileList()}}),$("#UserList").on("click","li",function(){$("#UserSel").html($(this).data("name")).data({user:$(this).data("user"),name:$(this).data("name")}),getFileList(),store.set(UserName+"user",$(this).data("user")+"||"+$(this).data("name"))}),$("input[name='charsetRadio']").click(function(){getFileDetailCon(DetailPath)}),$("#DownloadFile").click(function(){var e=$("#Info_0").html().split(" ");"KB"==e[1]||"Byte"==e[1]||"MB"==e[1]&&e[0]<=30?downloadFile("file/downloadFile",encodeUrl(DetailPath.substring(0,DetailPath.length-1)),$("#UserSel").data("user"),$("#UserSel").html()):swal("Error!",$.i18n.prop("fileMaxTip")+"ï¼","error")}),$("#FileList").on("click",".sel",function(e){$("#FileOpts .btnOpt").addClass("hidden"),SelPathArr=[],$(this).hasClass("selAll")?$(this).hasClass("active")?($(this).removeClass("active"),$("#FileList .sel").each(function(e,a){$(this).hasClass("selAll")||$(this).hasClass("hided")||($(this).removeClass("active"),$(this).data("active",!1))})):($(this).addClass("active"),$("#FileList .sel").each(function(e,a){$(this).hasClass("selAll")||$(this).hasClass("hided")||($(this).addClass("active"),$(this).data("active",!0))})):$(this).data("active")?($(this).removeClass("active"),$(this).data("active",!1)):($(this).addClass("active"),$(this).data("active",!0));var a=!0,t=!1;$("#FileList .sel").each(function(e,i){if(!$(this).hasClass("selAll")&&$(this).hasClass("active")){SelPathArr.push($(this).data("path")+"||"+$(this).data("name")+"||"+$(this).data("dir")),$(this).data("dir")&&(t=!0);var s=$(this).data("name")+"";s.lastIndexOf(".")!=-1&&ZipType.indexOf(s.substring(s.lastIndexOf(".")+1))!=-1||(a=!1)}}),SelPathArr.length>0?($("#FileOpts .btnOpt").removeClass("hidden"),t&&($("#FileOpts .btnCopy").addClass("hidden"),$("#FileOpts .btnUnzip").addClass("hidden")),a?$("#FileOpts .btnUnzip").removeClass("hidden"):$("#FileOpts .btnUnzip").addClass("hidden"),SelPathArr.length>1&&($("#FileOpts .btnRename").addClass("hidden"),$("#FileOpts .btnLoadFile").addClass("hidden"))):$("#FileOpts .btnOpt").addClass("hidden"),e.stopPropagation()}),$("#FileOpts .btnOpt").click(function(){function e(e,a,t){if(!t)return null;var i=[];return $.each(t.data,function(e,a){if(a.dir)if(null!=a.sons){for(var t=[],s=0;s<a.sons.length;s++)t.push({name:a.sons[s].path.name,isParent:!0});i.push({name:a.path.name,open:!0,children:t})}else i.push({name:a.path.name,isParent:!0})}),i}function a(e,a){a?(MovePathParam=[],$("#"+a.tId).parents("li").each(function(){MovePathParam.push($("#"+$(this).attr("id")+"_a").attr("title"))}),MovePathParam.reverse(),MovePathParam=MovePathParam.join("/")+"/"+a.name+"/"):MovePathParam=-1}function t(e,a,t){MovePath=[],$("#"+t.tId).parents("li").each(function(){MovePath.push($("#"+$(this).attr("id")+"_a").attr("title"))}),0==MovePath.length&&alert($.i18n.prop("moveTip")),MovePath.reverse(),MovePath=MovePath.join("/")+"/"+t.name+"/"}function e(e,a,t){if(!t)return null;var i=[];return $.each(t.data,function(e,a){if(a.dir)if(null!=a.sons){for(var t=[],s=0;s<a.sons.length;s++)t.push({name:a.sons[s].path.name,isParent:!0});i.push({name:a.path.name,open:!0,children:t})}else i.push({name:a.path.name,isParent:!0})}),i}function a(e,a){a?(MovePathParam=[],$("#"+a.tId).parents("li").each(function(){MovePathParam.push($("#"+$(this).attr("id")+"_a").attr("title"))}),MovePathParam.reverse(),MovePathParam=MovePathParam.join("/")+"/"+a.name+"/"):MovePathParam=-1}function t(e,a,t){MovePath=[],$("#"+t.tId).parents("li").each(function(){MovePath.push($("#"+$(this).attr("id")+"_a").attr("title"))}),0==MovePath.length&&alert($.i18n.prop("moveTip")),MovePath.reverse(),MovePath=MovePath.join("/")+"/"+t.name+"/"}function e(e,a,t){if(!t)return null;var i=[];return $.each(t.data,function(e,a){if(a.dir)if(null!=a.sons){for(var t=[],s=0;s<a.sons.length;s++)t.push({name:a.sons[s].path.name,isParent:!0});i.push({name:a.path.name,open:!0,children:t})}else i.push({name:a.path.name,isParent:!0})}),i}function a(e,a){a?(MovePathParam=[],$("#"+a.tId).parents("li").each(function(){MovePathParam.push($("#"+$(this).attr("id")+"_a").attr("title"))}),MovePathParam.reverse(),MovePathParam=MovePathParam.join("/")+"/"+a.name+"/"):MovePathParam=-1}function t(e,a,t){MovePath=[],$("#"+t.tId).parents("li").each(function(){MovePath.push($("#"+$(this).attr("id")+"_a").attr("title"))}),0==MovePath.length&&alert($.i18n.prop("moveTip")),MovePath.reverse(),MovePath=MovePath.join("/")+"/"+t.name+"/"}var i=$(this).data("type");if("rename"==i){var s=SelPathArr[0].split("||")[1];swal({title:$.i18n.prop("rename"),text:"",type:"input",showCancelButton:!0,closeOnConfirm:!1,animation:"slide-from-top",inputPlaceholder:$.i18n.prop("name"),inputValue:s},function(e){if(e===!1)return!1;if(""===e)return swal.showInputError($.i18n.prop("nameNotNull")),!1;if(e==s)return void swal.close();var a=SelPathArr[0].split("||"),t=a[0].substring(0,a[0].length-1);t=t.substring(0,t.lastIndexOf("/")+1),Util.ajax({url:"file/renameFileOrDirectory",data:{path:encodeUrl(a[0].substring(0,a[0].length-1)),newPath:encodeUrl(t+e),proxyUserName:$("#UserSel").data("user"),appName:$("#UserSel").html()},success:function(i){if(1==i.code){if(swal("Successful!","","success"),$("#FileDetail").is(":visible")){$("#Breadcrumb li:last-child a").data("path",t+e+"/").html(e),PathInfo[t+e+"/"]=PathInfo[a[0]];var s=SelPathArr[0].substring(SelPathArr[0].indexOf("||")+2);s=s.substring(s.indexOf("||")+2)}refreshFold("rename")}else swal("Error!",i.data,"error")}})})}else if("download"==i){var l=(SelPathArr[0].split("||")[0],[]);$.each(SelPathArr,function(e,a){var t=a.split("||")[0];t=t.substring(0,t.length-1),l.push(t)}),l=l.join("||"),downloadFile("file/downloadFile",encodeUrl(l),$("#UserSel").data("user"),$("#UserSel").html())}else if("del"==i)swal({title:$.i18n.prop("deleteConfirm"),text:"",type:"warning",showCancelButton:!0,confirmButtonText:$.i18n.prop("sure"),cancelButtonText:$.i18n.prop("cancel"),closeOnConfirm:!1,closeOnCancel:!0},function(e){if(e){var a=[];$.each(SelPathArr,function(e,t){var i=t.split("||")[0];i=i.substring(0,i.length-1),a.push(i)}),a=a.join("||");var t;t="file/deleteFile",Util.ajax({url:t,data:{path:encodeUrl(a),proxyUserName:$("#UserSel").data("user"),appName:$("#UserSel").html()},success:function(e){1==e.code?(swal("Successful!","","success"),refreshFold("del")):swal("Error!",e.data,"error")}})}});else if("move"==i){SelPathArr[0].split("||")[0];swal({title:$.i18n.prop("moveTo"),text:'<ul id="treeDemo" class="ztree"></ul>',html:!0,showCancelButton:!0,closeOnConfirm:!1,animation:"slide-from-top"},function(e){if(e){var a=[];$.each(SelPathArr,function(e,t){var i=t.split("||")[0];i=i.substring(0,i.length-1),a.push(i)}),a=a.join("||");var t=a[0].substring(0,a[0].length-1);t=t.substring(t.lastIndexOf("/")+1),swal({title:$.i18n.prop("inProcess"),text:"",imageUrl:"images/loading.gif",showConfirmButton:!1}),Util.ajax({url:"file/moveFile",data:{path:encodeUrl(a),newPath:encodeUrl(MovePath),proxyUserName:$("#UserSel").data("user"),appName:$("#UserSel").html()},success:function(e){1==e.code?swal("Successful!","","success"):swal("Error!",e.data,"error"),refreshFold("move")}})}});var r={view:{selectedMulti:!1},async:{enable:!0,url:"file/targetPath",autoParam:["id","name","level=lv"],otherParam:{proxyUserName:$("#UserSel").data("user"),appName:$("#UserSel").html(),path:function(){return MovePathParam}},dataFilter:e},callback:{beforeAsync:a,onClick:t}};$.fn.zTree.init($("#treeDemo"),r)}else if("copy"==i){SelPathArr[0].split("||")[0];swal({title:$.i18n.prop("copyTo"),text:'<ul id="treeDemo" class="ztree"></ul>',html:!0,showCancelButton:!0,closeOnConfirm:!1,animation:"slide-from-top"},function(e){if(e){swal({title:$.i18n.prop("inProcess"),text:"",imageUrl:"images/loading.gif",showConfirmButton:!1});var a=SelPathArr[0].split("||"),t=a[0].substring(0,a[0].length-1);t=t.substring(t.lastIndexOf("/")+1);var a=[];$.each(SelPathArr,function(e,t){var i=t.split("||")[0];i=i.substring(0,i.length-1),a.push(i)}),a=a.join("||"),Util.ajax({url:"file/copyFile",data:{path:encodeUrl(a),newPath:encodeUrl(MovePath),proxyUserName:$("#UserSel").data("user"),appName:$("#UserSel").html()},success:function(e){1==e.code?(swal("Successful!","","success"),refreshFold("move")):swal("Error!",e.data,"error")}})}});var r={view:{selectedMulti:!1},async:{enable:!0,url:"file/targetPath",autoParam:["id","name","level=lv"],otherParam:{proxyUserName:$("#UserSel").data("user"),appName:$("#UserSel").html(),path:function(){return MovePathParam}},dataFilter:e},callback:{beforeAsync:a,onClick:t}};$.fn.zTree.init($("#treeDemo"),r)}else if("unzip"==i){SelPathArr[0].split("||")[0];swal({title:$.i18n.prop("uncompressTo"),text:'<ul id="treeDemo" class="ztree"></ul>',html:!0,showCancelButton:!0,closeOnConfirm:!1,animation:"slide-from-top"},function(e){if(e){swal({title:$.i18n.prop("inProcess"),text:"",imageUrl:"images/loading.gif",showConfirmButton:!1});var a=[];$.each(SelPathArr,function(e,t){var i=t.split("||")[0];i=i.substring(0,i.length-1),a.push(i)}),a=a.join("||"),Util.ajax({url:"file/uncompressFile",data:{path:encodeUrl(a),newPath:encodeUrl(MovePath),proxyUserName:$("#UserSel").data("user"),appName:$("#UserSel").html()},success:function(e){1==e.code?(swal("Successful!","","success"),refreshFold("move")):swal("Error!",e.data,"error")}})}});var r={view:{selectedMulti:!1},async:{enable:!0,url:"file/targetPath",autoParam:["id","name","level=lv"],otherParam:{proxyUserName:$("#UserSel").data("user"),appName:$("#UserSel").html(),path:function(){return MovePathParam}},dataFilter:e},callback:{beforeAsync:a,onClick:t}};$.fn.zTree.init($("#treeDemo"),r)}else if("loadFile"==i){var l;"true"==SelPathArr[0].split("||")[2]?l=SelPathArr[0].split("||")[0]:(l=SelPathArr[0].split("||")[0],l=l.substring(0,l.length-1));var n=BootstrapDialog.show({title:$.i18n.prop("loadToTable"),cssClass:"loadFile-dialog",message:'<div class="addValueDialog form-horizontal" id="AddValueDialog" style="margin: 0 15px;font-size: 12px;"><div class="form-group"><label class="col-sm-3 control-label">'+$.i18n.prop("database")+'</label><div class="col-sm-9"><div id="DatabaseChosen"></div></div></div><div class="form-group"><label class="col-sm-3 control-label">'+$.i18n.prop("tableName")+'</label><div class="col-sm-9"><div id="TableChosen"></div></div></div><div class="form-group"><label class="col-sm-3 control-label">'+$.i18n.prop("partition")+'</label><div class="col-sm-9"><div id="PartitionList"></div></div></div><div class="form-group"><label class="col-sm-3 control-label">'+$.i18n.prop("isOverride")+'</label><div class="col-sm-9"><span class="radio" style="display: inline-block; margin-right: 20px;"><label><input type="radio" name="optionsRadios" id="optionsRadios1" value="yes" checked>'+$.i18n.prop("override")+'</label></span><span class="radio" style="display: inline-block; margin-right: 20px;"><label><input type="radio" name="optionsRadios" id="optionsRadios2" value="no">'+$.i18n.prop("noOverride")+'</label></span></div></div><div class="form-group" style="margin-bottom: 10px; padding-top: 10px;"><div class="col-sm-offset-3 col-sm-9"><a href="javascript:;" class="btn btn-primary" id="AddNewFeedbackBtn">'+$.i18n.prop("submit")+"</a></div></div></div>",onshown:function(){function e(e,t,i){var s={dbId:e,page:i||1,pageSize:1e4},l="entry/getTables";Util.ajax({url:l,data:s,success:function(e){e=e.data.rows,window.TableData=e;var t=e[0].tblId,i=e[0].tblName;$("#TableChosen").Chosen({data:e,selectedVal:[i],chosenConWidth:350,idAlias:"tblId",nameAlias:"tblName",initCallback:function(){a(t)},selectedCallback:function(e,t){a(e)}})}})}function a(e){var a;if($.each(TableData,function(t,i){if(i.tblId==e)return a=i.partitions,!1}),0==a.length)return $("#PartitionList").html(""),void $("#PartitionList").parents(".form-group").addClass("hidden");$("#PartitionList").parents(".form-group").removeClass("hidden");var t="";$.each(a,function(e,a){t+='<div class="item"><input type="text" disabled value="'+a+'" class="form-control pKey" style="display: inline-block; width: 47%"> : <input type="text" class="form-control pVal" style="display: inline-block;width: 50%"></div>'}),$("#PartitionList").html(t),$("#PartitionList .pVal").keyup(function(){$(this).parent().removeClass("hasError")})}Util.ajax({url:"entry/getDataBases",data:{},success:function(a){a=a.data;var t=a[0].dbName,i=a[0].dbId;$("#DatabaseChosen").Chosen({data:a,selectedVal:[t],chosenConWidth:350,idAlias:"dbId",nameAlias:"dbName",initCallback:function(){e(i,t)},selectedCallback:function(a,t){e(a,t)}})}}),$("#AddNewFeedbackBtn").off("click").on("click",function(){$(this).addClass("disable");var e=[],a=!0;$("#PartitionList .item").each(function(){""!=$(this).find(".pVal").val()?e.push($(this).find(".pKey").val()+"="+$(this).find(".pVal").val()):($(this).addClass("hasError"),swal("Error",$.i18n.prop("partitionNotNull")+"!","error"),a=!1)}),a&&(swal({title:$.i18n.prop("inProcess"),text:"",imageUrl:"images/loading.gif",showConfirmButton:!1}),Util.ajax({url:"file/loadFileToHive",data:{path:l,tblName:$("#DatabaseChosen .fixedVal").val()+"."+$("#TableChosen .fixedVal").val(),patitionName:e.join(","),overrite:$("input[name='optionsRadios']:checked").val(),proxyUserName:$("#UserSel").data("user"),appName:$("#UserSel").data("name")},success:function(e){1==e.code?(swal("Successful!","","success"),n.close(),refreshFold()):swal("Error",e.data,"error")}}))})}})}}),$("#FileOpts .btnNew").click(function(){var e=$(this).data("type"),a=$("#Breadcrumb li:last-child a").data("path");"file"==e?swal({title:$.i18n.prop("newFile"),text:"",type:"input",showCancelButton:!0,closeOnConfirm:!1,animation:"slide-from-top",inputPlaceholder:$.i18n.prop("fileName")},function(e){return e!==!1&&(""===e?(swal.showInputError("You need to write something!"),!1):void Util.ajax({url:"file/createFile",data:{path:encodeUrl(a+e),proxyUserName:$("#UserSel").data("user"),appName:$("#UserSel").html()},success:function(e){1==e.code?(swal("Successful!","","success"),refreshFold()):swal("Error!",e.data,"error")}}))}):"fold"==e&&swal({title:$.i18n.prop("newFold"),text:"",type:"input",showCancelButton:!0,closeOnConfirm:!1,animation:"slide-from-top",inputPlaceholder:$.i18n.prop("fold")},function(e){return e!==!1&&(""===e?(swal.showInputError("You need to write something!"),!1):void Util.ajax({url:"file/createDirectory",data:{path:encodeUrl(a+e),proxyUserName:$("#UserSel").data("user"),appName:$("#UserSel").html()},success:function(e){1==e.code?(swal("Successful!","","success"),refreshFold()):swal("Error!",e.data,"error")}}))})}),$("#FeedbackList").on("click","a",function(){if("AddNewFeedbackLink"!=$(this).attr("id")){var e,a=($(this).attr("data-id"),$(this).attr("data-reply")),t=$(this).find(".tit").html();e=""!=a?'<div class="addValueDialog" id="AddValueDialog"><h4>'+$.i18n.prop("feedbackCon")+'</h4><div class="feedCon">'+t+"</div><h4>"+$.i18n.prop("adminReply")+'</h4><div class="replyCon">'+a+'</div><div class="btnWrap"><a href="javascript:;" class="btn btn-primary" id="AddNewCloseBtn">'+$.i18n.prop("close")+"</a></div></div>":'<div class="addValueDialog" id="AddValueDialog"><div class="feedCon">'+t+'</div><div class="btnWrap"><a href="javascript:;" class="btn btn-primary" id="AddNewCloseBtn">'+$.i18n.prop("close")+"</a></div></div>";var i=BootstrapDialog.show({title:$.i18n.prop("feedbackDetail"),cssClass:"feedback-dialog",message:e,onshown:function(){$("#AddNewCloseBtn").off("click").on("click",function(){i.close()})}})}}),$("#FeedbackMenu").on("click",function(){$(this).hasClass("hasFeed")||newFeedback()}),$("#DropdownUser").click(function(){setTimeout(function(){$("#UserKeyword").focus()},100)}),$("#FileFilter").keyup(function(e){switch(e.keyCode){case 13:case 16:case 17:case 37:case 38:case 39:case 40:break;case 27:break;default:var a=$("#Breadcrumb li:last-child a").data("path");void 0!=a?getFileList(a):getFileList()}}),$("#FilePathGo").click(function(e){var a=$("#FilePathSearch").val();""!=a&&"/"!=a.substring(a.length-1)&&(a+="/"),getFileList(a)}),$("#TableHeader th").click(function(){var e=$(this).data("sort");e?"desc"==e?($(this).data("sort","asc"),$(this).find("i").removeClass("fa-sort-desc").addClass("fa-sort-asc"),e="asc"):($(this).data("sort","desc"),$(this).find("i").removeClass("fa-sort-asc").addClass("fa-sort-desc"),e="desc"):($(this).data("sort","asc"),$(this).find("i").addClass("fa-sort-asc"),e="asc");var a=$(this).data("type");Sort={orderBy:a,orderRule:e},refreshFold()})}function init(){getAppList(),bindEvent()}var _pathName=window.location.pathname;_pathName=_pathName.substring(1,_pathName.lastIndexOf("/")),window.UserName=$("#UserName").html()+"_"+_pathName+"_";var PathInfo={},AppList={},DetailPath,SelPathArr=[],MovePath,MovePathParam=-1,FileSize,Sort=-1,ZipType=["gz","deflate","bz2","tar","tgz","zip"];init()});