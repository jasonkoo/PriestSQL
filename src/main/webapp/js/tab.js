!function(a){a.fn.extend({chrometab:function(b){this.defaultOptions={changeTabCallback:function(){},newTabCallback:function(){}};var c=a.extend({},this.defaultOptions,b);return this.each(function(){function g(b){function d(a,b){a.getCursor();return(!b||b())&&setTimeout(function(){a.state.completionActive||a.showHint({completeSingle:!1})},100),CodeMirror.Pass}function f(a){return d(a,function(){var b=a.getTokenAt(a.getCursor());if("string"==b.type&&(!/['"]/.test(b.string.charAt(b.string.length-1))||1==b.string.length))return!1;var c=CodeMirror.innerMode(a.getMode(),b.state).state;return c.tagName})}var c=b.attr("id");window[c]=CodeMirror.fromTextArea(document.getElementById(c),{mode:"text/x-hive",indentWithTabs:!0,smartIndent:!0,lineNumbers:!0,matchBrackets:!0,autofocus:!1,styleSelectedText:!0,extraKeys:{"'a'":d,"'b'":d,"'c'":d,"'d'":d,"'e'":d,"'f'":d,"'g'":d,"'h'":d,"'i'":d,"'j'":d,"'k'":d,"'l'":d,"'m'":d,"'n'":d,"'o'":d,"'p'":d,"'q'":d,"'r'":d,"'s'":d,"'t'":d,"'u'":d,"'v'":d,"'w'":d,"'x'":d,"'y'":d,"'z'":d,"'.'":d,"'='":f,"Ctrl-Enter":"autocomplete",Tab:function(a){var b=Array(a.getOption("indentUnit")+1).join(" ");a.replaceSelection(b)}}}),window[c].on("change",function(){"undefined"!=typeof CodeRange&&CodeRange.clear(),a.cookie(UserName+"sql",window["CodeSql_"+a("#EditTable .cTab.active").data("target").split("e")[1]].getValue(),{expires:365})})}var b=a(this),d=b.find(".cTab"),e=!1,f=null;b.append(d.detach()),d.on("mousedown",function(b){if("closeTab"!=b.target.classList[0]){var d=a(this),g=d.data("target");a(".cTab").add(".cTab-pane").removeClass("active"),d.add(g).addClass("active"),c.changeTabCallback(),RunState=0,e=!0,f=d,offset=b.offsetX}}),b.on("click",".closeTab",function(e){if(e.preventDefault(),1!=b.find(".cTab").length){var f=a(this).parent();a(f.data("target")).remove(),a(f).remove(),f.hasClass("active")&&(b.find(".cTab").eq(0).addClass("active"),a(b.find(".cTab").eq(0).data("target")).addClass("active")),d=b.find(".cTab"),c.closeCallback()}}),a(document).on("mousemove",function(c){if(e||f){var g=c.clientX-offset,h=a(".cTabs").find(".cTab.active").index();f.offset({left:g}),t=d.sort(function(b,c){return a(b).offset().left>a(c).offset().left}),d.detach(),b.append(t),h!=a(".cTabs").find(".cTab.active").index()&&a(".cTabs").find(".cTab.active").css("left",""),d=b.find(".cTab"),c.preventDefault()}}),a(document).on("mouseup",function(){e&&f&&d.css("left",""),e=!1,f=null}),a("#AddTab").click(function(){if(5==a("#EditTable li").length)swal("\u6700\u591a\u663e\u793a\u67095\u4e2a\u7f16\u8f91\u533a\uff01","","error");else{var h=parseInt(a("#AddTab").attr("data-index"))+1;a("#AddTab").attr("data-index",h),a("#EditTable").append('<li class="cTab" data-target="#Page'+h+'"><span>\u65b0\u5efa\u67e5\u8be2'+h+'</span><button type="button" class="closeTab">\xd7</button></li>'),a(".cTab-content").append('<div class="cTab-pane" id="Page'+h+'"><textarea class="codeSql" id="CodeSql_'+h+'" name="code" placeholder="\u793a\u4f8b\uff1aselect * from xxx"></textarea><div class="runBtn btn-group-sm"><div class="sqlType"><input type="radio" data-val="3" id="sparksql_'+h+'" name="sqlType_'+h+'" checked><label for="sparksql_'+h+'">spark(\u8f83\u5feb)</label></div><div class="sqlType"><input type="radio" data-val="2" id="hivesql_'+h+'" name="sqlType_'+h+'"><label for="hivesql_'+h+'">mr(\u8f83\u6162)</label></div><button type="button" class="btn btn-primary btnRun" data-code="CodeSql_'+h+'" data-index="'+h+'">\u6267\u884c</button><button type="button" class="btn btn-primary btnSave" data-code="CodeSql_'+h+'" data-index="'+h+'">\u4fdd\u5b58</button><button type="button" class="btn btn-primary btnStop" data-code="CodeSql_'+h+'" data-index="'+h+'">\u505c\u6b62</button></div></div>'),c.newTabCallback(),b.find(".cTab").off("mousedown").on("mousedown",function(b){if(console.log(2),"closeTab"!=b.target.classList[0]){var d=a(this),g=d.data("target");a(".cTab").add(".cTab-pane").removeClass("active"),d.add(g).addClass("active"),c.changeTabCallback(),e=!0,f=d,offset=b.offsetX}}),b.find(".cTab:last").addClass("active").siblings().removeClass("active"),a(b.find(".cTab:last").data("target")).addClass("active").siblings().removeClass("active"),d=b.find(".cTab"),g(a("#Page"+h).find(".codeSql"))}}),g(a("#CodeSql_1"))})}})}(jQuery);